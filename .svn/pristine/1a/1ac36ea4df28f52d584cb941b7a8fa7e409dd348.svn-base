package Controllers;

import DAO.DAOUsuario;
import Mapeamentos.Usuario;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;
import javax.validation.Valid;
import org.springframework.stereotype.Controller;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.model;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class CadastroController {

    @RequestMapping("cadastro")
    public String CarregaCadastro(Model model) {
        model.addAttribute("Usuario", new Usuario());
        return "cadastro";
    }

    @RequestMapping("salvarUsuario")
    public String salvarUsuario(@ModelAttribute("Usuario") Usuario usuario, HttpServletRequest request, Model model) {
        DAOUsuario dao = new DAOUsuario();
        Usuario user = dao.verificaCpf(usuario);
        Usuario user1 = dao.verificaEmail(usuario);
        
        if (user != null) {
            String str = "cpf ja existente!";
            model.addAttribute("str", str);
            System.out.println("cpf ja existente");
            return "cadastro";
        }
        
        if (user1 != null) {
            String str1 = "email ja existente!";
            model.addAttribute("str1", str1);
            System.out.println("email ja existente");
            return "cadastro";
        }

        if (dao.salvarUsuario(usuario)) {

//            String str = "sucesso!";
//            model.addAttribute("str", str);
            return "redirect:login";
        } else {
//            String str = "Erro!";
//            model.addAttribute("str", str);
            return "cadastro";
        }

    }

//    @RequestMapping("verificaDuplicado")
//    public String verificaDuplicado(@ModelAttribute("Usuario") Usuario usuario, BindingResult result, HttpSession session, HttpServletRequest request,Model model) {
//        DAOUsuario dao = new DAOUsuario();
//        Usuario user = dao.verificaDuplicado(usuario);
//        System.out.println("cpf duplicado: " + user.getEmail());
//        System.out.println("email duplicado: " + user.getSenha());
//
//        if (user.getCpf() != null || user.getEmail() != null) {
//            String str = "email ou cpf ja existentes!";
//            model.addAttribute("str", str);
//            return "cadastro";
//        } else {
//            String str = "sucesso!";
//            model.addAttribute("str", str);
//
//            return "cadastro";
//        }
//    }
}
